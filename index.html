<!DOCTYPE html>
<html>
<head>
    <title>–ö–∞—Ä—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–µ—â–µ–π</title>
    <meta charset="utf-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { height: 100vh; width: 100%; }
        .save-btn { 
            position: fixed; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: #0088cc; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 25px; 
            font-size: 16px; 
            z-index: 1000;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <button class="save-btn" onclick="saveLocation()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Å—Ç–æ</button>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        const map = L.map('map').setView([55.7558, 37.6176], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let selectedLocation = null;
        let marker = null;

        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ URL (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        const urlParams = new URLSearchParams(window.location.search);
        const coordsParam = urlParams.get('coords');
        
        if (coordsParam) {
            const [lat, lng] = coordsParam.split(',').map(Number);
            if (!isNaN(lat) && !isNaN(lng)) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –ö–†–ê–°–ù–´–ú –º–∞—Ä–∫–µ—Ä–æ–º
                L.marker([lat, lng], {
                    icon: L.divIcon({
                        className: 'saved-marker',
                        html: 'üî¥',
                        iconSize: [25, 25],
                        iconAnchor: [12, 25]
                    })
                }).addTo(map);
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º –º–µ—Å—Ç–µ
                map.setView([lat, lng], 15);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
        map.on('click', function(e) {
            selectedLocation = e.latlng;
            
            // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–∞—Ä–∫–µ—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
            if (marker) {
                map.removeLayer(marker);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤–æ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –°–ò–ù–ò–ú –º–∞—Ä–∫–µ—Ä–æ–º
            marker = L.marker([selectedLocation.lat, selectedLocation.lng], {
                icon: L.divIcon({
                    className: 'selected-marker',
                    html: 'üîµ',
                    iconSize: [25, 25],
                    iconAnchor: [12, 25]
                })
            }).addTo(map);
        });

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
        function saveLocation() {
            if (selectedLocation) {
                const coords = `${selectedLocation.lat},${selectedLocation.lng}`;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram –±–æ—Ç–∞
                if (Telegram.WebApp) {
                    Telegram.WebApp.sendData(coords);
                    Telegram.WebApp.close();
                }
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ!');
            }
        }
    </script>
</body>
</html>
